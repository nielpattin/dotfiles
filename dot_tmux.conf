# Friendly tmux config
# Source file in chezmoi: ~/.local/share/chezmoi/dot_tmux.conf
# Target file after `chezmoi apply`: ~/.tmux.conf

##### Prefix / Leader ########################################################
# Use Ctrl+; as requested (instead of tmux default Ctrl+b)
# Note: Ctrl+; needs extended key reporting from the terminal.
unbind C-b
set -g prefix C-\;
bind C-\; send-prefix

# Keep a temporary fallback while terminal key reporting is being set up.
# Remove this later if you want Ctrl+; only.
set -g prefix2 C-a

# Make tmux understand modern extended keys (required for Ctrl+; in many terminals)
set -g xterm-keys on
set -g extended-keys on
set -as terminal-features ",*:extkeys"

##### Sensible defaults ######################################################
set -g mouse on
set -g history-limit 10000
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g focus-events on
set -g escape-time 10
set -g set-clipboard on

# Better color support in modern terminals
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-256color:RGB"

##### Window / pane behavior #################################################
# Keep current working directory when splitting / creating windows
bind c new-window -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Vim-like pane navigation (all behind prefix to avoid fish/terminal conflicts)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes quickly
bind H resize-pane -L 5
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5

# Fast kill bindings (no confirmation)
bind x kill-pane
bind X kill-window

##### Copy mode ##############################################################
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

##### Quality of life ########################################################
# Reload config: prefix + r
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

# Faster window switching with prefix + number (1..9)
bind-key -N "Select window 1" 1 select-window -t 1
bind-key -N "Select window 2" 2 select-window -t 2
bind-key -N "Select window 3" 3 select-window -t 3
bind-key -N "Select window 4" 4 select-window -t 4
bind-key -N "Select window 5" 5 select-window -t 5
bind-key -N "Select window 6" 6 select-window -t 6
bind-key -N "Select window 7" 7 select-window -t 7
bind-key -N "Select window 8" 8 select-window -t 8
bind-key -N "Select window 9" 9 select-window -t 9

##### Status line ############################################################
# Catppuccin-mocha friendly colors (less neon, better contrast)
set -g status-position top
set -g status-justify left
set -g status-left-length 30
set -g status-right-length 90

# Base status bar
set -g status-style "bg=#1e1e2e,fg=#cdd6f4"
set -g message-style "bg=#313244,fg=#cdd6f4"
set -g message-command-style "bg=#313244,fg=#89b4fa"

# Inactive / active window tabs
setw -g window-status-style "bg=#1e1e2e,fg=#7f849c"
setw -g window-status-current-style "bg=#1e1e2e,fg=#89b4fa,bold"
setw -g window-status-format " #I:#W "
setw -g window-status-current-format " #I:#W "

# Pane borders + active pane label (like your screenshot style)
set -g pane-border-style "fg=#45475a"
set -g pane-active-border-style "fg=#00d787,bold"
set -g pane-border-lines single

# Pane label: always show something stable
# title -> current command -> current path basename
setw -g pane-border-status top
setw pane-border-status top
setw -g pane-border-format " #{?pane_title,#{pane_title},#{?pane_current_command,#{pane_current_command},#{b:pane_current_path}}} "
setw pane-border-format " #{?pane_title,#{pane_title},#{?pane_current_command,#{pane_current_command},#{b:pane_current_path}}} "

# Border color behavior:
# - normal active pane: green
# - active pane in scroll/copy mode: yellow
# Use pane-active-border-style only (do NOT touch pane content style).
set-hook -g pane-mode-changed 'if -F "#{pane_in_mode}" "set -g pane-active-border-style \"fg=#f9e2af,bold\"" "set -g pane-active-border-style \"fg=#00d787,bold\""'

# Keep pane content appearance unchanged; rely on active border only
set -g window-style "default"
set -g window-active-style "default"
set -g pane-style "default"
set -g pane-active-style "default"

# Left/right status content
set -g status-left "#[fg=#89b4fa,bold] #S #[fg=#45475a]│#[default]"
set -g status-right "#[fg=#7f849c]%Y-%m-%d #[fg=#cdd6f4]%H:%M #[fg=#45475a]│#[fg=#a6e3a1] #h "
